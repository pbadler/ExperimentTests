source('H:/idahochart_remapping/ipm/genet_nbhood_annuli_Other.r')
source('H:/idahochart_remapping/ipm/genet_nbhood_annuli_Other.r')
source('H:/idahochart_remapping/ipm/genet_nbhood_annuli_Other.r')
source('H:/idahochart_remapping/ipm/genet_nbhood_annuli_Other.r')
rm(list=ls())
source('H:/idahochart_remapping/ipm/flag_grasses_within_ARTR_removals.r')
source('H:/idahochart_remapping/ipm/flag_grasses_within_ARTR_removals.r')
source('H:/idahochart_remapping/ipm/flag_grasses_within_ARTR_removals.r')
source('C:/Repos/ExperimentTests/removals/removal_analysis_wrapper.r')
dists <- read.csv(paste0(root,"/ExperimentTests/data/idaho_modern/speciesdata/IdahoModDistanceWeights_noExptl.csv"))
getwd()
iSpp
doSpp <- "HECO"
sppList <- c("ARTR","HECO","POSE","PSSP","allcov","allpts")
dataDir1 <- paste(root,"/ExperimentTests/data/idaho",sep="")
dataDir2 <- paste(root,"/ExperimentTests/data/idaho_modern",sep="")
nonCompLength.s=5 #Number of columns in SppData that are not measures of competitors
# set up distance weights------------------------------------------------
#dists <- read.csv(paste(dataDir2,"/speciesdata/IdahoModDistanceWeights_noExptl.csv",sep=""));
dists$allcov <- rowMeans(dists[,1:4])  # for "other" polygons use average of big 4
dists$allpts <- dists$POSE  # set forb dist wts = smallest grass (POSE)
# import old data--------------------------------------------------------
source("fetchGrowthData.r")
D1 <- fetchGdat(doSpp=doSpp,speciesList=sppList,datadir=dataDir1,distWts=dists)
D1$Treatment <- "Control"
# import modern data--------------------------------------------------------
D2 <- fetchGdat(doSpp=doSpp,speciesList=sppList,datadir=dataDir2,distWts=dists)
# merge in treatment data
tmp <- read.csv(paste(dataDir2,"/quad_info.csv",sep=""))
tmp <- tmp[,c("quad","Treatment")]
D2 <- merge(D2,tmp, all.x=T)
# account for removal in baseline years
if(doSpp!="ARTR"){
ii <- which(D2$year>=2011 & D2$Treatment=="No_shrub")
D2$W.ARTR[ii] <- 0
}else{
ii <- which(D2$year>=2011 & D2$Treatment=="No_grass")
D2$W.HECO[ii] <- 0 ; D2$W.POSE[ii] <- 0 ; D2$W.PSSP[ii] <- 0
}
# combine old and modern
allD <- rbind(D1,D2)
rm(D1,D2,tmp)
# clean up dataset ----------------------------------------------
allD$year[allD$year<2000] <- allD$year[allD$year<2000] + 1900
if(doSpp=="ARTR"){
keep <- which(is.element(allD$Treatment,c("Control","No_grass")))
}else{
keep <- which(is.element(allD$Treatment,c("Control","No_shrub")))
}
allD <- allD[keep,]
# remove outliers (large plants that obviously do not turn into tiny plants)
library(lme4)
# set up indicator variables
allD$Treatment2 <- allD$Treatment
allD$Treatment2[allD$year>2000] <- "Modern"
allD$Treatment3 <- allD$Treatment
allD$Treatment3[allD$Treatment=="Control" & allD$year>2000] <- "ControlModern"
allD$year <- as.factor(allD$year)
allD$GroupID <- as.numeric(allD$Group)
allD$yearID <- 100+as.numeric(allD$year) # for random year offset on intercept
View(allD)
m1 <- inla(logarea.t1 ~ logarea.t0 + Treatment + W.ARTR + W.HECO + W.POSE + W.PSSP + W.allcov + W.allpts +
f(yearID, model="iid", prior="normal",param=c(0,0.001))+
f(GroupID, model="iid", prior="normal",param=c(0,0.001))+
f(year, logarea.t0, model="iid", prior="normal",param=c(0,0.001)), data=allD,
family=c("gaussian"), verbose=FALSE,
control.predictor = list(link = 1),control.compute=list(dic=T,mlik=T),
control.inla = list(h = 1e-10),Ntrials=rep(1,nrow(allD)))
View(allD)
unique(allD$Treatment)
unique(allD$Treatment2)
unique(allD$Treatment2)
sort(unique(allD$quad))
# PBA March 2016
# call from removal_analysis_wrapper.r
#########################################
#  1. Import data and calculate W's
#########################################
doSpp <- "HECO"
sppList <- c("ARTR","HECO","POSE","PSSP","allcov","allpts")
dataDir1 <- paste(root,"/ExperimentTests/data/idaho",sep="")
dataDir2 <- paste(root,"/ExperimentTests/data/idaho_modern",sep="")
nonCompLength.s=5 #Number of columns in SppData that are not measures of competitors
# set up distance weights------------------------------------------------
#dists <- read.csv(paste(dataDir2,"/speciesdata/IdahoModDistanceWeights_noExptl.csv",sep=""));
dists$allcov <- rowMeans(dists[,1:4])  # for "other" polygons use average of big 4
dists$allpts <- dists$POSE  # set forb dist wts = smallest grass (POSE)
# import old data--------------------------------------------------------
source("fetchGrowthData.r")
D1 <- fetchGdat(doSpp=doSpp,speciesList=sppList,datadir=dataDir1,distWts=dists)
D1$Treatment <- "Control"
# import modern data--------------------------------------------------------
D2 <- fetchGdat(doSpp=doSpp,speciesList=sppList,datadir=dataDir2,distWts=dists)
# merge in treatment data
tmp <- read.csv(paste(dataDir2,"/quad_info.csv",sep=""))
tmp <- tmp[,c("quad","Treatment")]
D2 <- merge(D2,tmp, all.x=T)
# account for removal in baseline years
if(doSpp!="ARTR"){
ii <- which(D2$year>=2011 & D2$Treatment=="No_shrub")
D2$W.ARTR[ii] <- 0
}else{
ii <- which(D2$year>=2011 & D2$Treatment=="No_grass")
D2$W.HECO[ii] <- 0 ; D2$W.POSE[ii] <- 0 ; D2$W.PSSP[ii] <- 0
}
# combine old and modern
allD <- rbind(D1,D2)
rm(D1,D2,tmp)
sort(unique(allD$quad))
sort(unique(allD$year))
# PBA March 2016
# call from removal_analysis_wrapper.r
#########################################
#  1. Import data and calculate W's
#########################################
doSpp <- "HECO"
sppList <- c("ARTR","HECO","POSE","PSSP","allcov","allpts")
dataDir1 <- paste(root,"/ExperimentTests/data/idaho",sep="")
dataDir2 <- paste(root,"/ExperimentTests/data/idaho_modern",sep="")
nonCompLength.s=5 #Number of columns in SppData that are not measures of competitors
# set up distance weights------------------------------------------------
#dists <- read.csv(paste(dataDir2,"/speciesdata/IdahoModDistanceWeights_noExptl.csv",sep=""));
dists$allcov <- rowMeans(dists[,1:4])  # for "other" polygons use average of big 4
dists$allpts <- dists$POSE  # set forb dist wts = smallest grass (POSE)
# import old data--------------------------------------------------------
source("fetchGrowthData.r")
D1 <- fetchGdat(doSpp=doSpp,speciesList=sppList,datadir=dataDir1,distWts=dists)
D1$Treatment <- "Control"
# import modern data--------------------------------------------------------
D2 <- fetchGdat(doSpp=doSpp,speciesList=sppList,datadir=dataDir2,distWts=dists)
sort(unique(D2$quad))
rm(list=ls())
source('H:/idahochart_remapping/ipm/genet_nbhood_annuli.r')
rm(list=ls())
source('C:/Repos/ExperimentTests/removals/removal_analysis_wrapper.r')
warnings()
library("TeachingDemos") # for inset plots
library("quantreg")
source("Wdistrib/exploreSurvivalWs.R")
# clean up
tmp=ls() ; tmp=tmp[tmp!="root" & tmp!="statsOutput"]
rm(list=tmp)
sppList <-  c("ARTR","HECO","POSE","PSSP")
# read in distance weights
dists <- read.csv(paste0(root,"/ExperimentTests/data/idaho_modern/speciesdata/IdahoModDistanceWeights_noExptl.csv"))
max.CI <- F  # TRUE means use maximum removal effect
source("ibm/ibm_removal_1step.r")
source("ibm/summarize_sims1step.r")
max.CI <- T  # TRUE means use maximum removal effect
source("ibm/ibm_removal_1step.r")
source("ibm/summarize_sims1step.r")
# clean up
tmp=ls() ; tmp=tmp[tmp!="root" & tmp!="statsOutput"]
rm(list=tmp)
source('C:/Repos/ExperimentTests/removals/removal_analysis_wrapper.r')
sppList <-  c("ARTR","HECO","POSE","PSSP")
# read in distance weights
#dists <- read.csv(paste0(root,"/ExperimentTests/data/idaho_modern/speciesdata/IdahoModDistanceWeights_noExptl.csv"))
dists <- read.csv(paste0(root,"/ExperimentTests/data/idaho/speciesdata/IdahoDistanceWeights.csv"))
max.CI <- F  # TRUE means use maximum removal effect
source("ibm/ibm_removal_1step.r")
source("ibm/summarize_sims1step.r")
max.CI <- T  # TRUE means use maximum removal effect
source("ibm/ibm_removal_1step.r")
source("ibm/summarize_sims1step.r")
# clean up
tmp=ls() ; tmp=tmp[tmp!="root" & tmp!="statsOutput"]
rm(list=tmp)
max.CI <- F  # TRUE means use maximum removal effect
sppList <-  c("ARTR","HECO","POSE","PSSP")
source("ipm/get_W_functions.r")  # get neighbor distance decay functions
max.CI <- F  # TRUE means use maximum removal effect
sppList <-  c("ARTR","HECO","POSE","PSSP")
source("ipm/get_W_functions.r")  # get neighbor distance decay functions
#no treatment effects, all species
init.species <- c(1:4)
tlimit <- 2500
burn.in <- 500
trtEffects=F
source("ipm/IPM-setup.r")
source("ipm/IPM-getEquilibrium.r")
write.csv(covSave[(burn.in+1):tlimit,],"ipm/baselineCover.csv",row.names=F)
meanCover1 <- meanCover
#no treatment effects, ARTR removal
init.species <- c(2:4)
source("ipm/IPM-getEquilibrium.r")
write.csv(covSave[(burn.in+1):tlimit,],"ipm/baselineCover-noARTR.csv",row.names=F)
meanCover2 <- meanCover
# removal treatment effects, ARTR removal
init.species <- c(2:4)
trtEffects=T
max.CI=F
source("ipm/IPM-setup.r")
source("ipm/IPM-getEquilibrium.r")
write.csv(covSave[(burn.in+1):tlimit,],"ipm/removalCover-noARTR.csv",row.names=F)
meanCover3 <- meanCover
# removal treatment effects, ARTR removal, max treat effect
init.species <- c(2:4)
trtEffects=T
max.CI=T
source("ipm/IPM-setup.r")
source("ipm/IPM-getEquilibrium.r")
write.csv(covSave[(burn.in+1):tlimit,],"ipm/removalCover-noARTR-maxCI.csv",row.names=F)
meanCover4 <- meanCover
# # removal treatment effects, ARTR removal, no PSSP, what happens to HECO and POSE?
# init.species <- c(2:3)
# trtEffects=T
# max.CI=F
# source("ipm/IPM-setup.r")
# source("ipm/IPM-getEquilibrium.r")
# write.csv(covSave[(burn.in+1):tlimit,],"ipm/removalCover-noARTRnoPSSP.csv",row.names=F)
# baseline model (no treatment effects), remove all grasses
init.species <- c(1)
trtEffects=F
max.CI=F
source("ipm/IPM-setup.r")
source("ipm/IPM-getEquilibrium.r")
write.csv(covSave[(burn.in+1):tlimit,],"ipm/baselineCover-noGrass.csv",row.names=F)
# baseline model (with treatment effects), remove all grasses
init.species <- c(1)
trtEffects=T
max.CI=F
source("ipm/IPM-setup.r")
source("ipm/IPM-getEquilibrium.r")
write.csv(covSave[(burn.in+1):tlimit,],"ipm/removalCover-noGrass.csv",row.names=F)
simResults <- rbind(meanCover1,meanCover2,meanCover3)
colnames(simResults) <- sppList
write.csv(simResults,"ipm/simResults-meanCover.csv",row.names=F)
simResults <- rbind(meanCover1,meanCover2,meanCover4)
colnames(simResults) <- sppList
write.csv(simResults,"ipm/simResults-meanCover-maxCI.csv",row.names=F)
#no treatment effects, all species, boost ARTR cover
init.species <- c(1:4)
tlimit <- 2500
burn.in <- 500
trtEffects=F
max.CI=F
source("ipm/IPM-setup.r")
Rpars$intcpt.yr[,1] <- Rpars$intcpt.yr[,1]+1
source("ipm/IPM-getEquilibrium.r")
print(rbind(meanCover1,meanCover)) # compare baseline run with this one
source("ipm/IPM-figures.r") # plot results of ARTR removals
# eyeball results for ARTR cover following grass removals
baseline<-mean(read.csv("ipm/baselineCover.csv")[,1])
nograss1<-mean(read.csv("ipm/baselineCover-noGrass.csv")[,1])
nograss2<-mean(read.csv("ipm/removalCover-noGrass.csv")[,1])
ARTRcover<-c(baseline,nograss1,nograss2)
names(ARTRcover)<-c("Baseline","Baseline, grass removal","Treatment effects, grass removal")
print(ARTRcover)
13/16
13.5/16
